<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BUCKET Store</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
</head>
<body>
  <nav class="store-nav">
    <h1 class="glitch"><a href="#top" class="home-link">BUCKET</a></h1>
    <div>
      <a href="#art">Art</a>
      <a href="#clothing">Clothing</a>
      <a href="#about">About</a>
    </div>
  </nav>

  <main id="top">
    <div class="ritual-timer">ğŸ•’ Next Drop in: <span id="countdown">Loading...</span></div>

    <section id="art">
      <h2>Art</h2>
      <div class="product-grid">
        <div class="product-card glitch-hover">
          <div class="product-img sith-art-1"></div>
          <h3>â€œDesert Sith #1â€</h3>
          <p class="price">$40</p>
          <button onclick="purchase('bucketToken_art1', 'https://buy.stripe.com/test_sith_art')">Buy</button>
        </div>
        <div class="product-card glitch-hover">
          <div class="product-img sith-art-2"></div>
          <h3>â€œTemple Glitchâ€</h3>
          <p class="price">$60</p>
          <button onclick="purchase('bucketToken_art2', 'https://buy.stripe.com/test_glitch_art')">Buy</button>
        </div>
      </div>
    </section>

    <section id="clothing">
      <h2>Clothing</h2>
      <div class="product-grid">
        <div class="product-card glitch-hover">
          <div class="product-img sith-shirt"></div>
          <h3>â€œDark Desert Teeâ€</h3>
          <p class="price">$30</p>
          <button onclick="purchase('bucketToken_cloth1', 'https://buy.stripe.com/test_dark_tee')">Buy</button>
        </div>
        <div class="product-card glitch-hover">
          <div class="product-img red-hood"></div>
          <h3>â€œCrimson Hoodâ€</h3>
          <p class="price">$50</p>
          <button onclick="purchase('bucketToken_cloth2', 'https://buy.stripe.com/test_crimson_hood')">Buy</button>
        </div>
      </div>
    </section>

    <section id="unlocked" style="display:none;">
      <h2>ğŸ”“ Unlocked Lore</h2>
      <div id="unlockedItems"></div>
    </section>

    <section id="about">
      <h2>About</h2>
      <p>BUCKET is a Sith-temple inspired art and clothing label. We channel grim desert aesthetics, glitch culture, and spiritual darkness into wearable and visual statements.</p>
    </section>

    <button id="installBtn" style="display:none;">ğŸ“² Install BUCKET</button>
  </main>

  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <p>Proceed to complete your purchase?</p>
      <button id="modalBuyBtn">Buy Now</button>
    </div>
  </div>

  <script>
    const unlocks = {
      bucketToken_art1: "ğŸ–¼ <b>Desert Sith #1:</b> â€˜The sands whisper of a power not yet reborn...â€™",
      bucketToken_art2: "ğŸ’€ <b>Temple Glitch:</b> â€˜They shattered the code to bind the Force with pixels.â€™",
      bucketToken_cloth1: "ğŸ§ <b>Dark Desert Tee:</b> â€˜Those who wear the heat cannot fear the flame.â€™",
      bucketToken_cloth2: "ğŸ“– <b>Crimson Hood:</b> â€˜The hood is not worn. It chooses.â€™"
    };

    let glitchSoundPlayed = false;

    function playGlitchSound() {
      if (!glitchSoundPlayed) {
        const ctx = new AudioContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'square';
        osc.frequency.value = 240;
        osc.connect(gain);
        gain.connect(ctx.destination);
        gain.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.3);
        osc.start();
        osc.stop(ctx.currentTime + 0.3);
        glitchSoundPlayed = true;
      }
    }

    function purchase(token, url) {
      localStorage.setItem(token, "true");
      showUnlocked();
      openModal(url);
      playGlitchSound();
    }

    function showUnlocked() {
      const container = document.getElementById("unlockedItems");
      container.innerHTML = "";
      let hasUnlock = false;
      for (const token in unlocks) {
        if (localStorage.getItem(token)) {
          hasUnlock = true;
          const div = document.createElement("div");
          div.innerHTML = unlocks[token];
          container.appendChild(div);
        }
      }
      if (hasUnlock) document.getElementById("unlocked").style.display = "block";

      // If all unlocked, invert theme for "Dark Mode is a Lie"
      if (Object.keys(unlocks).every(token => localStorage.getItem(token))) {
        document.body.classList.add("inverted");
      }
    }

    function openModal(link) {
      const modal = document.getElementById("modal");
      const btn = document.getElementById("modalBuyBtn");
      modal.classList.remove("hidden");
      btn.onclick = () => {
        window.open(link, "_blank");
        modal.classList.add("hidden");
      };
    }

    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
    }

    function startTimer() {
      const countdown = document.getElementById("countdown");
      const target = new Date();
      target.setHours(target.getHours() + 6); // 6 hours countdown
      setInterval(() => {
        const now = new Date();
        const diff = target - now;
        if(diff <= 0) {
          countdown.textContent = "The Dark Awaits...";
          return;
        }
        const hours = Math.floor(diff / 1000 / 60 / 60);
        const mins = Math.floor(diff / 1000 / 60) % 60;
        const secs = Math.floor(diff / 1000) % 60;
        countdown.textContent = `${hours}h ${mins}m ${secs}s`;
      }, 1000);
    }

    window.onload = () => {
      showUnlocked();
      startTimer();
      let deferredPrompt;
      const installBtn = document.getElementById('installBtn');
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'inline-block';
      });
      installBtn.addEventListener('click', () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(() => {
          installBtn.style.display = 'none';
        });
      });
    };
  </script>
</body>
</html>
